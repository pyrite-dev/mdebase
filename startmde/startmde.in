#!/bin/sh

kill_all () {
	kill $1 $PANEL $WM
}

stop_all () {
	kill_all
	exit
}

reload_all () {
	kill_all -HUP
}

restart_all () {
	kill_all
	sleep 0.5
	start_all
}

start_all () {
	"@CMAKE_INSTALL_FULL_BINDIR@/mpanel" &
	PANEL="$!"

	"@CMAKE_INSTALL_FULL_BINDIR@/milkwm" &
	WM="$!"
}

trap "stop_all" INT
trap "stop_all" TERM
trap "reload_all" HUP
trap "restart_all" USR1

start_all

while true; do
	wait
done
